library(nflverse)
library(tidyverse)
library(stringr)
library(dplyr)
library(readr)
#This first section of code will be to explore the data, just to get some ideas of what to do
#make sure your directory call is right
games <- read.csv('NFL/games.csv')
players <- read.csv('NFL/players.csv')
plays <- read.csv('NFL/plays.csv')
tackles <- read.csv('NFL/tackles.csv')
tracking_week_1 <- read.csv('NFL/tracking_week_1.csv')
tracking_week_2 <- read.csv('NFL/tracking_week_2.csv')
tracking_week_3 <- read.csv('NFL/tracking_week_3.csv')
tracking_week_4 <- read.csv('NFL/tracking_week_4.csv')
tracking_week_5 <- read.csv('NFL/tracking_week_5.csv')
tracking_week_6 <- read.csv('NFL/tracking_week_6.csv')
tracking_week_7 <- read.csv('NFL/tracking_week_7.csv')
tracking_week_8 <- read.csv('NFL/tracking_week_8.csv')
tracking_week_9 <- read.csv('NFL/tracking_week_9.csv')

data<-rbind(tracking_week_1, tracking_week_2, tracking_week_3, tracking_week_4, tracking_week_5, tracking_week_6,
            tracking_week_7, tracking_week_8, tracking_week_9)

#Basic all plays analyzed
plot(plays$playResult, plays$expectedPointsAdded, main="Expected points added and yards gained on the play",
xlab = "Yards gained on the play", ylab = "Expected number of points added")
lmfs <- lm(playResult ~ expectedPointsAdded, data = plays)
summary(lmfs)
abline(reg = lmfs, col = "blue", lwd = 2)

#Seperate by Formation
shotgun <- plays[plays$offenseFormation == "SHOTGUN",]
iform <- plays[plays$offenseFormation == "I_FORM",]
singleback <- plays[plays$offenseFormation == "SINGLEBACK",]
empty <- plays[plays$offenseFormation == "EMPTY",]
pistol <- plays[plays$offenseFormation == "PISTOL",]
wildcat <- plays[plays$offenseFormation == "WILDCAT",]
jumbo <- plays[plays$offenseFormation == "JUMBO",]

#Plot of all Shotgun plays
plot(shotgun$playResult, shotgun$expectedPointsAdded, main="Expected points added based on yards gained on shotgun plays",
xlab = "Yards gained on the play", ylab = "Expected number of points added")
lmfs <- lm(playResult ~ expectedPointsAdded, data = shotgun)
summary(lmfs)
abline(lmfs, col = "blue", lwd = 2)

#Barplot of Average EPA by Formation
avgepa_shotgun <- sum(shotgun$expectedPointsAdded, na.rm = TRUE)/6382
avgepa_iform <- sum(iform$expectedPointsAdded, na.rm = TRUE)/933
avgepa_singleback <- sum(singleback$expectedPointsAdded, na.rm = TRUE)/3528
avgepa_empty <- sum(empty$expectedPointsAdded, na.rm = TRUE)/854
avgepa_pistol <- sum(pistol$expectedPointsAdded, na.rm = TRUE)/603
avgepa_wildcat <- sum(wildcat$expectedPointsAdded, na.rm = TRUE)/91
avgepa_jumbo <- sum(jumbo$expectedPointsAdded, na.rm = TRUE)/119

formation <- c("Shotgun",
          "I-Form", "Singleback","Empty",
          "Pistol", "Wildcat", "Jumbo")
average_epa <- c(avgepa_shotgun, avgepa_iform,
                 avgepa_singleback, avgepa_empty, avgepa_pistol,
                 avgepa_wildcat, avgepa_jumbo)
par(mar = c(8,4,4,2) + 0.1)
barplot(average_epa, names.arg = formation, col = "blue",
main = "Average EPA by formation",
ylab = "Average EPA", las = 3)
mtext("Formations", side = 1, line = 6)


#ggplot barplot of epa by formation

install.packages("ggplot2")
library(ggplot2)
data<- data.frame(group = c("Shotgun",
                            "I-Form", "Singleback","Empty",
                            "Pistol", "Wildcat", "Jumbo"), 
                  average = c(avgepa_shotgun, avgepa_iform,
                              avgepa_singleback, avgepa_empty, avgepa_pistol,
                              avgepa_wildcat, avgepa_jumbo))
ggplot(data, aes(x = group, y = average)) + geom_bar(stat = "identity",
fill = "skyblue") + labs(title = "Average EPA by Formation", x = "Formation", y = "Average EPA") +
  theme_minimal()
